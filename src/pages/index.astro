---
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";
import { ClientRouter } from "astro:transitions";

// Datos del perfil
const nombre = "Ricardo Joaquín Díaz Arriagada";
const titulo = "Analista Programador · Duoc UC | Último semestre";

// Obtenemos los proyectos de la carpeta content/proyectos
const proyectos = await getCollection("proyectos");
---

<html lang="es">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Portfolio - {nombre}</title>
		<ClientRouter />
	</head>
	<body>
		<div class="parallax" aria-hidden="true">
			<div class="parallax-layer layer-stars" data-speed="0.15"></div>
			<div class="parallax-layer layer-clouds" data-speed="0.3"></div>
			<div class="parallax-layer layer-hills" data-speed="0.45"></div>
		</div>
		<main>
			<header class="fade-in hero">
				<h1 class="minecraft-title">
					Hola, soy <span class="minecraft-jitter">{nombre}</span>
				</h1>
				<p class="subtitle">{titulo}</p>
			</header>

			<section id="sobre" class="section-card">
				<h2 class="minecraft-section">Sobre mí</h2>
				<p class="lead">
					Desarrollador en formación con foco en backend y arquitectura de
					microservicios. Me interesa construir soluciones claras, escalables
					y con buena documentación. Busco mi primera experiencia profesional
					para aportar con responsabilidad y seguir creciendo.
				</p>
				<div class="info-grid">
					<div class="info-item">
						<h3>Educación</h3>
						<p>Duoc UC, Analista Programador (último semestre).</p>
					</div>
					<div class="info-item">
						<h3>Intereses</h3>
						<p>Backend, APIs REST, SQL, calidad de código.</p>
					</div>
					<div class="info-item">
						<h3>Disponibilidad</h3>
						<p>Práctica o rol junior. Abierto a proyectos remotos o híbridos.</p>
					</div>
				</div>
			</section>

			<section id="proyectos" class="section-card">
				<h2 class="minecraft-section">Mis Proyectos</h2>
				<div class="grid-proyectos">
					{
						proyectos.map((p) => (
							<a
								href={`/proyectos/${p.slug}`}
								class="project-card-link"
							>
								<article class="project-card minecraft-float">
									<div class="card-header">
										{p.data.titulo.includes("Web") ? (
											<Icon
												name="react"
												class="icon-main"
											/>
										) : (
											<Icon
												name="android"
												class="icon-main"
											/>
										)}
										<h3>{p.data.titulo}</h3>
									</div>
									<div class="tech-stack">
										{p.data.tecnologias.map((tech) => (
											<span class="tag">
												{tech === "Java" && (
													<Icon
														name="java"
														class="icon-tag"
													/>
												)}
												{tech}
											</span>
										))}
									</div>
									<p>{p.data.descripcion}</p>
									<span class="read-more">
										Ver detalles →
									</span>
								</article>
							</a>
						))
					}
				</div>
			</section>

			<section id="habilidades" class="fade-in section-card">
				<h2 class="minecraft-section">Habilidades Técnicas</h2>
				<ul class="skills-list">
					<li>
						<Icon name="java" class="icon-list" />
						<strong>Lenguajes:</strong> Java, Kotlin, SQL, Python, JS
						y CSS
					</li>
					<li>
						<Icon name="react" class="icon-list" />
						<strong>Frameworks:</strong> Astro, Spring Boot, React
					</li>
					<li>
						<strong>Arquitectura:</strong> Microservicios y Diseño de
						APIs REST
					</li>
					<li>
						<Icon name="android" class="icon-list" />
						<strong>Móvil:</strong> Desarrollo nativo Android (Kotlin)
					</li>
					<li>
						<strong>Base de Datos:</strong> Gestión y modelado SQL
					</li>
				</ul>
			</section>
		</main>
	</body>
</html>

<script>
	const layers = document.querySelectorAll(".parallax-layer");
	const onScroll = () => {
		const y = window.scrollY || 0;
		layers.forEach((layer) => {
			const speed = Number(layer.getAttribute("data-speed") || 0);
			layer.style.transform = `translate3d(0, ${y * speed}px, 0)`;
		});
	};
	window.addEventListener("scroll", onScroll, { passive: true });
	onScroll();
</script>

<style is:global>
	@import url("https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600;700&display=swap");
	:root {
		/* Paleta Terraria */
		--primary: #ffd166;
		--text: #f7f4e9;
		--text-muted: #d0c7b5;
		--card-bg: rgba(46, 35, 24, 0.75);
		--bg-overlay: rgba(18, 28, 44, 0.25);
		--glass-border: rgba(255, 209, 102, 0.35);
		--pixel-border: #3a2a1a;
		--grass: #46a038;
		--dirt: #6b4a2a;
		--dirt-dark: #4b311c;
		--sky-top: #6ec5ff;
		--sky-bottom: #cfefff;
	}

	body {
		margin: 0;
		padding: 0;
		min-height: 100vh;

		/* Fondo con imagen original */
		background-image:
			linear-gradient(var(--bg-overlay), var(--bg-overlay)),
			url("/cat rengoku.jpg");
		background-size: cover;
		background-position: center;
		background-attachment: fixed;
		background-repeat: no-repeat;
		background-color: #0b1020;

		font-family: "Inter", system-ui, sans-serif;
		color: var(--text);
		line-height: 1.6;
	}

	.parallax {
		position: fixed;
		inset: 0;
		z-index: 0;
		pointer-events: none;
		overflow: hidden;
	}

	.parallax-layer {
		position: absolute;
		inset: -10% 0 0 0;
		background-repeat: repeat;
		will-change: transform;
		opacity: 0.6;
	}

	.layer-stars {
		background-image:
			radial-gradient(#fff 1px, transparent 1.5px),
			radial-gradient(#ffd166 1px, transparent 1.5px);
		background-size: 120px 120px, 200px 200px;
		background-position: 0 0, 40px 80px;
		opacity: 0.35;
	}

	.layer-clouds {
		background-image:
			radial-gradient(rgba(255, 255, 255, 0.35) 20%, transparent 60%);
		background-size: 240px 120px;
		background-position: 0 30px;
		opacity: 0.5;
	}

	.layer-hills {
		background-image:
			linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(28, 20, 12, 0.6) 70%),
			repeating-linear-gradient(
				90deg,
				rgba(70, 160, 56, 0.35) 0 24px,
				rgba(75, 49, 28, 0.45) 24px 48px
			);
		background-size: 100% 100%, 160px 80px;
		background-position: bottom;
		opacity: 0.7;
		inset: 30% 0 0 0;
	}

	main {
		position: relative;
		z-index: 1;
	}

	main {
		max-width: 1100px;
		margin: 0 auto;
		padding: 64px 20px 80px;
		display: flex;
		flex-direction: column;
		gap: 48px;
	}

	/* Animación de entrada suave */
	.fade-in {
		animation: fadeIn 0.8s ease-in;
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
			transform: translateY(10px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.hero {
		padding: 28px 28px 24px;
		border-radius: 16px;
		background: var(--card-bg);
		border: 2px solid var(--pixel-border);
		box-shadow:
			0 10px 30px rgba(0, 0, 0, 0.35),
			inset 0 0 0 2px rgba(255, 255, 255, 0.06);
		position: relative;
	}
	.hero::before {
		content: "";
		position: absolute;
		left: 0;
		top: 0;
		width: 100%;
		height: 8px;
		background: linear-gradient(90deg, var(--grass), #5bc64a);
		border-bottom: 2px solid var(--pixel-border);
		border-top-left-radius: 14px;
		border-top-right-radius: 14px;
	}
	h1 {
		font-size: clamp(2.1rem, 4vw, 3.2rem);
		margin-bottom: 0.5rem;
	}
		.minecraft-title,
		.minecraft-section {
			font-family: "Press Start 2P", system-ui, sans-serif;
			letter-spacing: 0.5px;
			text-transform: none;
			text-shadow:
				0 0 6px rgba(255, 209, 102, 0.45),
				0 0 14px rgba(255, 209, 102, 0.2);
		}

		.minecraft-section {
			font-size: clamp(1.1rem, 2.2vw, 1.4rem);
		}

		.minecraft-jitter {
			display: inline-block;
			animation: minecraftJitter 2.8s steps(4, end) infinite;
		}

		.minecraft-float {
			animation: minecraftFloat 6s steps(6, end) infinite;
		}

		@keyframes minecraftJitter {
			0%,
			100% {
				transform: translate(0, 0);
			}
			25% {
				transform: translate(1px, -1px);
			}
			50% {
				transform: translate(-1px, 1px);
			}
			75% {
				transform: translate(1px, 1px);
			}
		}

		@keyframes minecraftFloat {
			0%,
			100% {
				transform: translateY(0);
			}
			50% {
				transform: translateY(-6px);
			}
		}

		@media (prefers-reduced-motion: reduce) {
			.minecraft-jitter,
			.minecraft-float {
				animation: none;
			}
		}
	h1 span {
		color: var(--primary);
	}
	.subtitle {
		font-size: 1.1rem;
		color: var(--text-muted);
	}

	.section-card {
		padding: 24px 24px 18px;
		border-radius: 16px;
		background: var(--card-bg);
		border: 2px solid var(--pixel-border);
		box-shadow:
			0 8px 20px rgba(0, 0, 0, 0.3),
			inset 0 0 0 2px rgba(255, 255, 255, 0.05);
		position: relative;
	}
	.section-card::before {
		content: "";
		position: absolute;
		left: 0;
		top: 0;
		width: 100%;
		height: 8px;
		background: linear-gradient(90deg, var(--grass), #5bc64a);
		border-bottom: 2px solid var(--pixel-border);
		border-top-left-radius: 14px;
		border-top-right-radius: 14px;
	}

	section {
		scroll-margin-top: 80px;
	}

	h2 {
		border-bottom: 2px solid var(--primary);
		display: inline-block;
		padding-bottom: 5px;
		margin-top: 0;
		margin-bottom: 1.25rem;
	}

	.lead {
		font-size: 1.05rem;
		color: var(--text-muted);
		margin-bottom: 1.25rem;
	}

	.info-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
		gap: 16px;
	}

	.info-item {
		padding: 12px 14px;
		border-radius: 10px;
		border: 2px solid var(--pixel-border);
		background: rgba(28, 20, 12, 0.85);
		box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.04);
	}

	.info-item h3 {
		margin: 0 0 6px;
		font-size: 0.95rem;
		color: var(--primary);
	}

	.grid-proyectos {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
		gap: 1.5rem;
	}

	.project-card-link {
		text-decoration: none;
		color: inherit;
		display: block;
	}

	.project-card {
		background: var(--card-bg);
		padding: 1.5rem;
		border-radius: 12px;
		border: 2px solid var(--pixel-border);
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		height: 100%;
		box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
	}

	.project-card:hover {
		transform: translateY(-8px);
		border-color: var(--primary);
		box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
	}

	.card-header {
		display: flex;
		align-items: center;
		gap: 12px;
		margin-bottom: 10px;
	}

	.icon-main {
		width: 32px;
		height: 32px;
		color: var(--primary);
	}

	.tech-stack {
		display: flex;
		flex-wrap: wrap;
		gap: 8px;
		margin-bottom: 1rem;
	}

	.tag {
		display: flex;
		align-items: center;
		gap: 6px;
		background: rgba(28, 20, 12, 0.9);
		color: var(--primary);
		font-weight: bold;
		font-size: 0.8rem;
		padding: 4px 10px;
		border-radius: 20px;
		border: 2px solid var(--pixel-border);
	}

	.read-more {
		display: block;
		margin-top: 1rem;
		font-size: 0.9rem;
		color: var(--primary);
		font-weight: bold;
	}

	.project-card-link:focus-visible {
		outline: 2px solid var(--primary);
		outline-offset: 6px;
		border-radius: 14px;
	}

	.skills-list {
		list-style: none;
		padding: 0;
	}
	.skills-list li {
		display: flex;
		align-items: center;
		gap: 10px;
		background: rgba(28, 20, 12, 0.85);
		margin-bottom: 0.75rem;
		padding: 12px 12px;
		border-radius: 8px;
		border-left: 4px solid var(--primary);
		border: 2px solid var(--pixel-border);
	}

	.icon-list {
		width: 20px;
		height: 20px;
		color: var(--primary);
	}
	strong {
		color: var(--primary);
		margin-right: 5px;
	}
</style>
